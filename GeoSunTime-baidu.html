<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>获取经纬度并计算所在地日出日落时间</title>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=XXXXXXXXXXX"></script><!--请将ak=之后的文字换成你在百度地图API上得到的AK-->
<script src="xy-conv.js"></script>
<script type="text/javascript">
var bdLng;
var bdLat;
var GPSLng;
var GPSLat;
var sunTime;
var d = new Date()
var localOffset = -d.getTimezoneOffset()/60
function getPosiFromBd(){
	var geolocation = new BMap.Geolocation();
	geolocation.getCurrentPosition(function(r){
		if(this.getStatus() == BMAP_STATUS_SUCCESS){
      bdLng=r.point.lng
      bdLat=r.point.lat
      document.getElementById("bd-lng").innerHTML=bdLng;
      document.getElementById("bd-lat").innerHTML=bdLat;
      bd2GPS_out()
    }
		else {
      document.getElementById("bd-error").innerHTML=this.getStatus();
		}
	},{enableHighAccuracy: true})
	//关于状态码
	//BMAP_STATUS_SUCCESS	检索成功。对应数值“0”。
	//BMAP_STATUS_CITY_LIST	城市列表。对应数值“1”。
	//BMAP_STATUS_UNKNOWN_LOCATION	位置结果未知。对应数值“2”。
	//BMAP_STATUS_UNKNOWN_ROUTE	导航结果未知。对应数值“3”。
	//BMAP_STATUS_INVALID_KEY	非法密钥。对应数值“4”。
	//BMAP_STATUS_INVALID_REQUEST	非法请求。对应数值“5”。
	//BMAP_STATUS_PERMISSION_DENIED	没有权限。对应数值“6”。(自 1.1 新增)
	//BMAP_STATUS_SERVICE_UNAVAILABLE	服务不可用。对应数值“7”。(自 1.1 新增)
	//BMAP_STATUS_TIMEOUT	超时。对应数值“8”。(自 1.1 新增)
}
function bd2GPS(lng,lat){
  var arr2 = GPS.bd_decrypt(lat,lng);
  var arr3 = GPS.gcj_decrypt(arr2['lat'], arr2['lon']);
  return {'lng': arr3['lon'], 'lat': arr3['lat']};
}
function bd2GPS_out(){
  var gpsarr=bd2GPS(bdLng,bdLat);
  GPSLng=gpsarr['lng'];
  GPSLat=gpsarr['lat']
  document.getElementById("gps-lng").innerHTML=GPSLng;
  document.getElementById("gps-lat").innerHTML=GPSLat;
  loadXMLDoc()
}
function loadXMLDoc(){
  xmlhttp=new XMLHttpRequest();
  xmlhttp.onreadystatechange=function(){
    if (xmlhttp.readyState==4 && xmlhttp.status==200){
      eval("sunTime ="+xmlhttp.responseText);
      document.getElementById("sunrise").innerHTML=sunTime.sunrise
      document.getElementById("sunset").innerHTML=sunTime.sunset
      if(sunTime.period=="day"){
        welcome="白天好！"
      }else{
        welcome="晚上好！"
      }
      document.getElementById("welcome").innerHTML=welcome
      document.getElementById("welcome-exact-chinese").innerHTML=sunTime.period_exact_chinese+"好！"
      document.getElementById("welcome-exact-western").innerHTML="Good "+sunTime.period_exact_western+"! "
      document.getElementById("loading").innerHTML=""
    }
  }
xmlhttp.open("GET","sunget.php?lng="+GPSLng+"&lat="+GPSLat+"&localOffset="+localOffset+"&t=" + Math.random(),true);
xmlhttp.send();
}
function getSunInfo(){
 getPosiFromBd()}
</script>
</head>
<body onload="getSunInfo()">
<span id="loading">正在计算中，请稍后……</span>
<div>百度经度：<span id="bd-lng"></span>&nbsp;百度纬度：<span id="bd-lat"></span>&nbsp;<span id="bd-error"></span></div>
<div>GPS经度：<span id="gps-lng"></span>&nbsp;GPS纬度：<span id="gps-lat"></span></div>
<div>日出时间：<span id="sunrise"></span>&nbsp;日落时间：<span id="sunset"></span></div>
<div>问候语：<span id="welcome"></span></div>
<div>中式确切问候语：<span id="welcome-exact-chinese"></span></div>
<div>西式确切问候语：<span id="welcome-exact-western"></span></div>
</div>
</body>
</html>
